import React, { useState } from 'react';
import { ScrollView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';

// ðŸ‘‡ We import the address you just saved in config.js
// The ".." means "go up one folder" to find it.
import { API_URL } from '../config';

export default function App() {
  const [status, setStatus] = useState("Ready to Connect");
  const [log, setLog] = useState("");

  const testConnection = async () => {
    setStatus("Pinging Server...");
    setLog(`Attempting to reach: ${API_URL}...`);
    
    try {
      // We try to fetch the docs page because it's always there
      const response = await fetch(`${API_URL}/docs`);
      
      if (response.ok) {
        setStatus("Connected! ðŸŸ¢");
        setLog(prev => prev + "\nSuccess: Server is online and reachable!");
      } else {
        setStatus("Error ðŸ”´");
        setLog(prev => prev + `\nServer reached, but returned status: ${response.status}`);
      }
    } catch (error) {
      setStatus("Failed âŒ");
      setLog(prev => prev + `\nConnection Failed.\nError: ${error.message}\n\nCheck: Is Tailscale ON?`);
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.header}>Von Agent Mobile</Text>
      
      <View style={styles.card}>
        <Text style={styles.label}>Target Server:</Text>
        <Text style={styles.ip}>{API_URL}</Text>
      </View>

      <TouchableOpacity style={styles.button} onPress={testConnection}>
        <Text style={styles.buttonText}>Test Connection</Text>
      </TouchableOpacity>

      <Text style={styles.statusLabel}>Status: {status}</Text>

      <ScrollView style={styles.console}>
        <Text style={styles.consoleText}>{log}</Text>
      </ScrollView>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: '#0f172a', padding: 20, paddingTop: 60 },
  header: { fontSize: 28, fontWeight: 'bold', color: '#38bdf8', textAlign: 'center', marginBottom: 30 },
  card: { backgroundColor: '#1e293b', padding: 15, borderRadius: 12, marginBottom: 20, borderLeftWidth: 4, borderLeftColor: '#38bdf8' },
  label: { color: '#94a3b8', fontSize: 12, textTransform: 'uppercase', marginBottom: 5 },
  ip: { color: '#e2e8f0', fontSize: 16, fontFamily: 'monospace' },
  button: { backgroundColor: '#2563eb', padding: 16, borderRadius: 12, alignItems: 'center', shadowColor: '#2563eb', shadowOpacity: 0.3, shadowRadius: 10 },
  buttonText: { color: 'white', fontWeight: 'bold', fontSize: 18 },
  statusLabel: { color: 'white', textAlign: 'center', marginTop: 25, fontSize: 18, fontWeight: '600' },
  console: { marginTop: 20, backgroundColor: '#000', borderRadius: 8, padding: 15, flex: 1 },
  consoleText: { color: '#4ade80', fontFamily: 'monospace', fontSize: 12 }
});